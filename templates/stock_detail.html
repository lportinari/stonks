{% extends "base.html" %}

{% block title %}{{ stock.empresa or stock.ticker }} - Análise Completa{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Header com Logo e Informações Básicas -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-2 text-center">
                            {% if stock.logo_url %}
                            <img src="{{ stock.logo_url }}" alt="{{ stock.empresa or stock.ticker }}" 
                                 class="img-fluid rounded" style="max-width: 80px; height: auto;"
                                 onerror="this.src='https://via.placeholder.com/80x80?text={{ stock.ticker[:4] }}'">
                            {% else %}
                            <div class="bg-secondary text-white rounded d-flex align-items-center justify-content-center" 
                                 style="width: 80px; height: 80px; font-size: 24px; font-weight: bold;">
                                {{ stock.ticker[:4] }}
                            </div>
                            {% endif %}
                        </div>
                        <div class="col-md-10">
                            <h2 class="mb-1">{{ stock.empresa or stock.ticker }}</h2>
                            <p class="text-muted mb-2">
                                <span class="badge bg-primary">{{ stock.ticker }}</span>
                                {% if stock.short_name %}
                                <small class="ms-2">{{ stock.short_name }}</small>
                                {% endif %}
                                {% if stock.setor %}
                                <small class="ms-3"><i class="fas fa-industry"></i> {{ stock.setor }}</small>
                                {% endif %}
                                {% if stock.currency %}
                                <small class="ms-3"><i class="fas fa-money-bill"></i> {{ stock.currency }}</small>
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Preços e Variação -->
    <div class="row mb-4">
        <div class="col-md-8">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-chart-line"></i> Preços e Variação</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 text-center">
                            <h4 class="text-primary">R$ {{ "%.2f"|format(stock.cotacao or 0) }}</h4>
                            <small class="text-muted">Cotação Atual</small>
                        </div>
                        <div class="col-md-4 text-center">
                            {% if stock.regular_market_change is not none %}
                            <h4 class="{% if stock.regular_market_change > 0 %}text-success{% elif stock.regular_market_change < 0 %}text-danger{% else %}text-secondary{% endif %}">
                                {% if stock.regular_market_change > 0 %}+{% endif %}R$ {{ "%.2f"|format(stock.regular_market_change) }}
                            </h4>
                            <small class="text-muted">Variação Diária</small>
                            {% endif %}
                        </div>
                        <div class="col-md-4 text-center">
                            {% if stock.regular_market_change_percent is not none %}
                            <h4 class="{% if stock.regular_market_change_percent > 0 %}text-success{% elif stock.regular_market_change_percent < 0 %}text-danger{% else %}text-secondary{% endif %}">
                                {% if stock.regular_market_change_percent > 0 %}+{% endif %}{{ "%.2f"|format(stock.regular_market_change_percent) }}%
                            </h4>
                            <small class="text-muted">% Variação Diária</small>
                            {% endif %}
                        </div>
                    </div>
                    
                    <hr>
                    
                    <div class="row">
                        <div class="col-md-3">
                            <small class="text-muted">Máxima Dia</small>
                            <p class="mb-1 fw-bold">R$ {{ "%.2f"|format(stock.regular_market_day_high or 0) }}</p>
                        </div>
                        <div class="col-md-3">
                            <small class="text-muted">Mínima Dia</small>
                            <p class="mb-1 fw-bold">R$ {{ "%.2f"|format(stock.regular_market_day_low or 0) }}</p>
                        </div>
                        <div class="col-md-3">
                            <small class="text-muted">Abertura</small>
                            <p class="mb-1 fw-bold">R$ {{ "%.2f"|format(stock.regular_market_open or 0) }}</p>
                        </div>
                        <div class="col-md-3">
                            <small class="text-muted">Fechamento Anterior</small>
                            <p class="mb-1 fw-bold">R$ {{ "%.2f"|format(stock.regular_market_previous_close or 0) }}</p>
                        </div>
                    </div>
                    
                    {% if stock.regular_market_day_range %}
                    <div class="row mt-2">
                        <div class="col-md-12">
                            <small class="text-muted">Range do Dia</small>
                            <p class="mb-1 fw-bold">{{ stock.regular_market_day_range }}</p>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="fas fa-info-circle"></i> Informações</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-12">
                            <small class="text-muted">Volume</small>
                            <p class="mb-2 fw-bold">
                                {% if stock.volume %}
                                {{ "{:,}".format(stock.volume|int) }}
                                {% else %}
                                N/A
                                {% endif %}
                            </p>
                        </div>
                        <div class="col-12">
                            <small class="text-muted">Market Cap</small>
                            <p class="mb-2 fw-bold">
                                {% if stock.valor_mercado %}
                                R$ {{ "{:,.0f}".format(stock.valor_mercado) }}
                                {% else %}
                                N/A
                                {% endif %}
                            </p>
                        </div>
                        <div class="col-12">
                            <small class="text-muted">Última Atualização</small>
                            <p class="mb-1 fw-bold">
                                {% if stock.data_atualizacao %}
                                {{ stock.data_atualizacao.strftime('%d/%m/%Y %H:%M') }}
                                {% else %}
                                N/A
                                {% endif %}
                            </p>
                        </div>
                        <div class="col-12">
                            <small class="text-muted">Fonte</small>
                            <p class="mb-1 fw-bold">{{ stock.fonte_dados or 'N/A' }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 52 Semanas -->
    {% if stock.fifty_two_week_high or stock.fifty_two_week_low or stock.fifty_two_week_range %}
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card shadow-sm">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="fas fa-calendar-alt"></i> 52 Semanas</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <small class="text-muted">Máxima 52 Semanas</small>
                            <p class="mb-1 fw-bold">R$ {{ "%.2f"|format(stock.fifty_two_week_high or 0) }}</p>
                        </div>
                        <div class="col-md-4">
                            <small class="text-muted">Mínima 52 Semanas</small>
                            <p class="mb-1 fw-bold">R$ {{ "%.2f"|format(stock.fifty_two_week_low or 0) }}</p>
                        </div>
                        <div class="col-md-4">
                            <small class="text-muted">Range 52 Semanas</small>
                            <p class="mb-1 fw-bold">{{ stock.fifty_two_week_range or 'N/A' }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Indicadores Fundamentais -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card shadow-sm">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0"><i class="fas fa-chart-pie"></i> Indicadores Fundamentais</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <small class="text-muted">P/L</small>
                            <p class="mb-1 fw-bold">{{ "%.2f"|format(stock.pl or 0) }}</p>
                        </div>
                        <div class="col-md-3">
                            <small class="text-muted">P/VP</small>
                            <p class="mb-1 fw-bold">{{ "%.2f"|format(stock.pvp or 0) }}</p>
                        </div>
                        <div class="col-md-3">
                            <small class="text-muted">Dividend Yield</small>
                            <p class="mb-1 fw-bold">{{ "%.2f"|format(stock.div_yield or 0) }}%</p>
                        </div>
                        <div class="col-md-3">
                            <small class="text-muted">ROE</small>
                            <p class="mb-1 fw-bold">{{ "%.2f"|format(stock.roe or 0) }}%</p>
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-md-3">
                            <small class="text-muted">Price Earnings</small>
                            <p class="mb-1 fw-bold">{{ "%.2f"|format(stock.price_earnings or 0) }}</p>
                        </div>
                        <div class="col-md-3">
                            <small class="text-muted">Earnings per Share</small>
                            <p class="mb-1 fw-bold">R$ {{ "%.2f"|format(stock.earnings_per_share or 0) }}</p>
                        </div>
                        <div class="col-md-3">
                            <small class="text-muted">Margem Líquida</small>
                            <p class="mb-1 fw-bold">{{ "%.2f"|format(stock.margem_liquida or 0) }}%</p>
                        </div>
                        <div class="col-md-3">
                            <small class="text-muted">EV/EBITDA</small>
                            <p class="mb-1 fw-bold">{{ "%.2f"|format(stock.ev_ebitda or 0) }}</p>
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-md-3">
                            <small class="text-muted">PSR</small>
                            <p class="mb-1 fw-bold">{{ "%.2f"|format(stock.psr or 0) }}</p>
                        </div>
                        <div class="col-md-3">
                            <small class="text-muted">Liquidez Corrente</small>
                            <p class="mb-1 fw-bold">{{ "%.2f"|format(stock.liquidity or 0) }}</p>
                        </div>
                        <div class="col-md-3">
                            <small class="text-muted">Dív. Patrimônio</small>
                            <p class="mb-1 fw-bold">{{ "%.2f"|format(stock.div_liquida_patrim or 0) }}%</p>
                        </div>
                        <div class="col-md-3">
                            <small class="text-muted">ROIC</small>
                            <p class="mb-1 fw-bold">{{ "%.2f"|format(stock.roic or 0) }}%</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Crescimento e Score -->
    <div class="row mb-4">
        <div class="col-md-8">
            <div class="card shadow-sm">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0"><i class="fas fa-chart-line"></i> Crescimento</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <small class="text-muted">Crescimento Receita 5A</small>
                            <p class="mb-1 fw-bold">{{ "%.2f"|format(stock.cresc_receita_5a or 0) }}%</p>
                        </div>
                        <div class="col-md-6">
                            <small class="text-muted">Crescimento Lucro 5A</small>
                            <p class="mb-1 fw-bold">{{ "%.2f"|format(stock.cresc_lucro_5a or 0) }}%</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-header {% if stock.score_final >= 70 %}bg-success{% elif stock.score_final >= 50 %}bg-warning{% else %}bg-danger{% endif %} text-white">
                    <h5 class="mb-0"><i class="fas fa-star"></i> Score Final</h5>
                </div>
                <div class="card-body text-center">
                    <h2 class="{% if stock.score_final >= 70 %}text-success{% elif stock.score_final >= 50 %}text-warning{% else %}text-danger{% endif %}">
                        {{ "%.1f"|format(stock.score_final or 0) }}
                    </h2>
                    <small class="text-muted">
                        {% if stock.rank_posicao %}
                        Ranking #{{ stock.rank_posicao }}
                        {% endif %}
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- Botões de Ação -->
    <div class="row">
        <div class="col-md-12 text-center">
            <a href="/" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Voltar
            </a>
            {% if stock.setor %}
            <a href="/?setor={{ stock.setor }}" class="btn btn-info ms-2">
                <i class="fas fa-filter"></i> Ver Setor {{ stock.setor }}
            </a>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}